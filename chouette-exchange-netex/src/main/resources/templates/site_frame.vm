<!-- =========================================== -->
<!-- NEPTUNE StopPlaces (StopArea of type StopPlace) are mapped to NeTEx StopPlace -->
<SiteFrame version="any" id="${line.objectIdPrefix()}:SiteFrame:SF01"> 
  <topographicPlaces>
    #foreach( $stopPlace in $stopPlaces ) 
    <TopographicPlace version="$stopPlace.objectVersion" id="${stopPlace.objectIdPrefix()}:TopographicPlace:${stopPlace.objectIdSuffix()}">
      <Descriptor>
        <Name>$stopPlace.name</Name>
      </Descriptor>
      #if($stopPlace.parent)
      <ParentZoneRef version="$stopPlace.parent.objectVersion" ref="${stopPlace.parent.objectIdPrefix()}:TopographicPlace:${stopPlace.parent.objectIdSuffix()}"/>
      #end
    </TopographicPlace>
    #end
  </topographicPlaces> 
  <stopPlaces>
    #foreach( $commercialStopPoint in $commercialStopPoints )
    <StopPlace version="$commercialStopPoint.objectVersion" id="${commercialStopPoint.objectIdPrefix()}:StopPlace:${commercialStopPoint.objectIdSuffix()}">
     #if( $commercialStopPoint.name )
     <Name>$!esc.xml( $commercialStopPoint.name)</Name>
     #end

     #if( $commercialStopPoint.comment )
     <Description>$!esc.xml( $commercialStopPoint.comment)</Description>
     #end

     #if( $commercialStopPoint.registrationNumber )
     <PrivateCode>$!esc.xml( $commercialStopPoint.registrationNumber)</PrivateCode>
     #end

     #if( $commercialStopPoint.areaCentroid.latitude && $commercialStopPoint.areaCentroid.longitude)
      <Centroid>
        #set( $areaCentroid = $commercialStopPoint.areaCentroid )
        #set( $projectedPoint = $areaCentroid.projectedPoint )
        <Location id="${areaCentroid.objectIdPrefix()}:Location:${areaCentroid.objectIdSuffix()}">
          #if ( $areaCentroid.longitude && $areaCentroid.latitude )
          <Longitude>$areaCentroid.longitude</Longitude>
          <Latitude>$areaCentroid.latitude</Latitude>
          #end
          #if ( $projectedPoint.x && $projectedPoint.y )
          <gml:pos srsName="$projectedPoint.projectionType">
            $projectedPoint.x $projectedPoint.y
          </gml:pos>
          #end
        </Location>
      </Centroid>
     #end

     #if( $commercialStopPoint.parent )
     <ParentZoneRef version="$commercialStopPoint.parent.objectVersion" ref="${commercialStopPoint.parent.objectIdPrefix()}:StopPlace:${commercialStopPoint.parent.objectIdSuffix()}" />
     #end
      
      #if( $commercialStopPoint.nearestTopicName )
      <LandMark>$!esc.xml( $commercialStopPoint.nearestTopicName)</LandMark>
      #end

      <TopographicPlaceView>
        <Name>$commercialStopPoint.name</Name>
      </TopographicPlaceView>
      
      #if($commercialStopPoint.parent)
      <ContainedInPlaceRef version="$commercialStopPoint.parent.objectVersion" ref="${commercialStopPoint.parent.objectIdPrefix()}:TopographicPlace:${commercialStopPoint.parent.objectIdSuffix()}"/>
      #end

      #if($commercialStopPoint.fareCode)
      <tariffZones>
        <TariffZoneRef version="any" ref="${commercialStopPoint.objectIdPrefix()}:TariffZone:${commercialStopPoint.fareCode}"/>
      </tariffZones>
      #end
      <quays>
        #foreach( $quay in $commercialStopPoint.containedStopAreas )
        <Quay version="$quay.objectVersion" id="${quay.objectIdPrefix()}:Quay:${quay.objectIdSuffix()}">
         #if( $quay.name )
         <Name>$!esc.xml( $quay.name)</Name>
         #end

         #if( $quay.comment )
         <Description>$!esc.xml( $quay.comment)</Description>
         #end

         #if( $quay.registrationNumber )
         <PrivateCode>$!esc.xml( $quay.registrationNumber)</PrivateCode>
         #end

         #if( $quay.nearestTopicName )
         <LandMark>$!esc.xml( $quay.nearestTopicName)</LandMark>
         #end

      #set( $areaCentroid = $quay.areaCentroid )
      #if($areaCentroid)
          <Centroid>
            #set( $areaCentroid = $quay.areaCentroid )
            #set( $projectedPoint = $areaCentroid.projectedPoint )
            <Location id="${areaCentroid.objectIdPrefix()}:Location:${areaCentroid.objectIdSuffix()}">
              #if ( $areaCentroid.longitude && $areaCentroid.latitude )
              <Longitude>$areaCentroid.longitude</Longitude>
              <Latitude>$areaCentroid.latitude</Latitude>
              #end
              #if ( $projectedPoint.x && $projectedPoint.y )
              <gml:pos srsName="$projectedPoint.projectionType">
                $projectedPoint.x $projectedPoint.y
              </gml:pos>
              #end
            </Location>
          </Centroid>
          #set( $address = $areaCentroid.address )
          #if($address)
          <PostalAddress version="any" id="${areaCentroid.objectIdPrefix()}:PostalAddress:${areaCentroid.objectIdSuffix()}">
            <CountryRef ref="fr"/>
            #if ( $address.streetName )
            <AddressLine1>$!esc.xml( $address.streetName)</AddressLine1>
            #end
            #if ( $address.countryCode )
            <PostCode>$!esc.xml( $address.countryCode)</PostCode>
            #end
          </PostalAddress>
          #end
      #end
          #if($quay.fareCode)
          <tariffZones>
            <TariffZoneRef version="any" ref="${quay.objectIdPrefix()}:TariffZone:${quay.fareCode}"/>
          </tariffZones>
          #end
        </Quay>	
        #end	
      </quays>
      <entrances>
        #foreach( $accessPoint in $accessPoints )
        <StopPlaceEntrance version="any" ref="${accessPoint.objectIdPrefix()}:StopPlaceEntrance:${accessPoint.objectIdSuffix()}">
          <Centroid>
            <Location>
              <Longitude>$!accessPoint.longitude</Longitude>
              <Latitude>$!accessPoint.latitude</Latitude>
              <srsName>$!accessPoint.longLatType</srsName>
            </Location>
          </Centroid> 
          <StopPlaceEntranceRef ref="$accessPoint.containedIn"/>
          #if ( $accessPoint.name )
          <Name>$!esc.xml($accessPoint.name)</Name>          
          #end
          <isEntry>#if( $accessPoint.type == "In" || $accessPoint.type == "In Out")true#{else}false#end</isEntry>
          <isExit>#if( $accessPoint.type == "Out" || $accessPoint.type == "In Out")true#{else}false#end</isExit>         
          <TimeBand>
            <StartTime>$!accessPoint.openingTime</StartTime>
            <EndTime>$!accessPoint.closingTime</EndTime>
          </TimeBand>
          #if ( $accessPoint.comment )
          <Description>$!esc.xml($accessPoint.comment)</Description>  
          #end
          ## TODO : Add enum   
        </StopPlaceEntrance> 
        #end
      </entrances> 
    </StopPlace>
    #end				
  </stopPlaces>
  <!-- Assignments of Path Links -->
  <pathLinks>
    #foreach( $accessLink in $accessLinks )       
    <PathLink id="${accessLink.objectIdPrefix()}:SiteConnection:${accessLink.objectIdSuffix()}" version="$accessLink.objectVersion">  
      #if ( $accessLink.name )
      <Name>$!esc.xml($accessLink.name)</Name>
      #end
      <From>
        <EntranceRef ref="$accessLink.startOfLinkId" />
      </From>
      <To> 
        <PlaceRef ref="$accessLink.endOfLinkId" /> 
      </To> 
      <Distance>$!accessLink.linkDistance</Distance>
      #set($linkType = $accessLink.linkType)
      #if ( $linkType == "Underground" ) 
        <Covered>indoors</Covered>
      #elseif ( $linkType == "Overground" )
        <Covered>outdoors</Covered>
      #elseif ( $linkType == "Mixed" )
        <Covered>mixed</Covered>
      #else
        <Covered>unknown</Covered>
      #end 
      <TransfertDuration>
        <DefaultDuration>$!accessLink.defaultDuration</DefaultDuration>
        <FrequentTravellerDuration>$!accessLink.frequentTravellerDuration</FrequentTravellerDuration>
        <OccasionalTravellerDuration>$!accessLink.occasionalTravellerDuration</OccasionalTravellerDuration>
        <MobilityRestrictedTravellerDuration>$!accessLink.mobilityRestrictedTravellerDuration</MobilityRestrictedTravellerDuration> 
      </TransfertDuration>
      <AccessibilityAssesment>
        <MobilityimpairedAccess>$!accessLink.mobilityRestrictedSuitable</MobilityimpairedAccess>
      </AccessibilityAssesment>
      ## TODO : Add enum  
    </PathLink>
    #end
  </pathLinks>  

</SiteFrame>
